<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
  <link rel="stylesheet" href="css/demo.css" type="text/css">
</head>
<body>
<div id="map"></div>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
<script src="js/demo.js"></script>
<script>
  var base = getTileSea();
  var map = new ol.Map({
    controls: ol.control.defaults({
      attribution: false
    }),
    target: 'map',
    layers: [base],
    view: new ol.View({
      center: ol.proj.fromLonLat([98.633, 31.607]),
      zoom:4,
      minZoom:0,
      maxZoom:18
    })
  });
  var extent = [122.7, 36.5, 123, 37];
  var geom = ol.geom.Polygon.fromExtent(extent);
  geom.transform('EPSG:4326', 'EPSG:3857');
  
  map.getView().fit(geom.getExtent());
  
  var feature = new ol.Feature({
    geometry: geom
  });
  var source = new ol.source.Vector({
    features: [feature]
  });
  var vector = new ol.layer.Vector({
    source: source,
    style:  new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: '#2E8B57',
        width: 3
      }),
      image: new ol.style.Circle({
        radius: 3,
        fill: new ol.style.Fill({
          color: '#c40403'
        })
      })
    })
  });
  map.addLayer(vector);
  addAreaShip();
  function addAreaShip() {
    var features = source.getFeatures();
    for(var i = 0;i<features.length;i++){
      var feat = features[i];
      var geom = feat.getGeometry().getType();
      if(geom.toLowerCase()==='point') source.removeFeature(feat);
    }
    
    var url ='http://api.shipxy.com/apicall/GetAreaShip?v=2&k=ea144475022d4fb1a2c2a94dfa6bb88f&enc=1&mode=0&scode=0&xy=122700000,37000000-123000000,37000000-123000000,36500000-122700000,36500000';
    $.ajax({
      url: url,
      success: function (data) {
        data = JSON.parse(data);
        data = data.data;
        var features = [];
        for(var i = 0;i<data.length;i++){
          var lonLat = [data[i].lon / 1000000, data[i].lat / 1000000];
          var feature = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.fromLonLat(lonLat))
          });
          features.push(feature);
        }
        source.addFeatures(features);
      }
    });
  }
</script>
</body>
</html>
